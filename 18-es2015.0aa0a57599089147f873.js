(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"/Gcl":function(e,t,i){"use strict";i.r(t),i.d(t,"vehicleSearchModule",function(){return F});var n=i("ofXK"),c=i("TEn/"),o=i("3Pt+"),a=i("mrSG"),l=i("fXoL"),s=i("27b0"),r=i("tp0D"),b=i("7zfz"),h=i("sYmb"),d=i("jIHw"),u=i("Q4Mo"),p=i("LuMj");function g(e,t){if(1&e){const e=l.Tb();l.Sb(0,"form"),l.Sb(1,"ion-item",6),l.Sb(2,"h5"),l.Ec(3),l.dc(4,"translate"),l.dc(5,"translate"),l.Rb(),l.Rb(),l.Sb(6,"ion-item",6),l.Sb(7,"ion-label",7),l.Ec(8),l.dc(9,"translate"),l.Rb(),l.Sb(10,"ion-input",8),l.ac("input",function(t){return l.wc(e),l.cc().onInputAmount(t)}),l.Rb(),l.Rb(),l.Sb(11,"ion-item",6),l.Sb(12,"ion-label",7),l.Ec(13),l.dc(14,"translate"),l.Rb(),l.Sb(15,"ion-input",9),l.ac("input",function(t){return l.wc(e),l.cc().onInputDiscount(t)}),l.Rb(),l.Rb(),l.Sb(16,"ion-item",6),l.Sb(17,"ion-label",7),l.Ec(18),l.dc(19,"translate"),l.Rb(),l.Nb(20,"ion-input",10),l.Rb(),l.Sb(21,"ion-item",6),l.Sb(22,"ion-label",7),l.Ec(23),l.dc(24,"translate"),l.Rb(),l.Sb(25,"ion-input",11),l.ac("input",function(t){return l.wc(e),l.cc().onInputReceivedFrom(t)}),l.Rb(),l.Rb(),l.Sb(26,"ion-item"),l.Sb(27,"ion-label"),l.Ec(28),l.dc(29,"translate"),l.Rb(),l.Sb(30,"p-radioButton",12),l.ac("ngModelChange",function(t){return l.wc(e),l.cc().paymentMode=t}),l.Rb(),l.Sb(31,"label",13),l.Ec(32,"Cash "),l.Rb(),l.Sb(33,"p-radioButton",14),l.ac("ngModelChange",function(t){return l.wc(e),l.cc().paymentMode=t}),l.Rb(),l.Sb(34,"label",13),l.Ec(35,"UPI "),l.Rb(),l.Sb(36,"p-radioButton",15),l.ac("ngModelChange",function(t){return l.wc(e),l.cc().paymentMode=t}),l.Rb(),l.Sb(37,"label",16),l.Ec(38,"Card "),l.Rb(),l.Rb(),l.Sb(39,"ion-row"),l.Sb(40,"ion-col"),l.Sb(41,"ion-button",17),l.ac("click",function(){return l.wc(e),l.cc().save()}),l.Ec(42),l.dc(43,"translate"),l.Rb(),l.Rb(),l.Rb(),l.Rb()}if(2&e){const e=l.cc();l.Ab(3),l.Ic(" ",l.ec(4,16,"transactionEntry.totalPendingAmount")," : ",e.totalPendingAmount," ",l.ec(5,18,"rs"),""),l.Ab(5),l.Gc(" ",l.ec(9,20,"transactionEntry.amount"),""),l.Ab(2),l.jc("value",e.amount),l.Ab(3),l.Fc(l.ec(14,22,"transactionEntry.discount")),l.Ab(2),l.jc("value",e.discount),l.Ab(3),l.Fc(l.ec(19,24,"transactionEntry.totalPayable")),l.Ab(2),l.jc("value",e.totalPayable),l.Ab(3),l.Gc(" ",l.ec(24,26,"transactionHistory.receivedFrom"),""),l.Ab(2),l.jc("value",e.receivedFrom),l.Ab(3),l.Fc(l.ec(29,28,"transactionEntry.amountMode")),l.Ab(2),l.jc("ngModel",e.paymentMode),l.Ab(3),l.jc("ngModel",e.paymentMode),l.Ab(3),l.jc("ngModel",e.paymentMode),l.Ab(6),l.Fc(l.ec(43,30,"save"))}}let m=(()=>{class e{constructor(e,t,i,n,c,o){this.dbconfig=e,this.dbprovider=t,this.alertController=i,this.popoverController=n,this.messageService=c,this.translate=o,this.totalPendingAmount=0,this.discount=0,this.paymentMode="cash",this.tableName="transaction",this.billTableName="billDetail",this.receivedFrom="",this.savedSuccessMessage="Data saved successfully",this.cspfmEditorType=""}ngOnInit(){console.log(this.billdetail);var e=6e4*(new Date).getTimezoneOffset(),t=new Date(Date.now()-e).toISOString().slice(0,-5);this.billdate=t,this.amount=this.billdetail.pendingAmount,this.totalPayable=this.amount-this.discount,this.monthName=this.billdetail.Month,this.totalPendingAmount=this.billdetail.totalAmount}ngAfterViewInit(){}closePopover(){this.popoverController.dismiss()}onInputAmount(e){this.totalPayable=e.target.value-this.discount,this.amount=e.target.value}onInputDiscount(e){this.totalPayable=this.amount-e.target.value,this.discount=e.target.value}onInputReceivedFrom(e){this.receivedFrom=e.target.value}save(){console.log(this.transactionObj),this.billdetail.pendingAmount<this.amount?this.presentAlert():(this.transactionObj=JSON.parse(JSON.stringify(this.dbconfig.configuration.tableStructure[this.tableName])),this.transactionObj.transactionAmount=Number(this.amount),this.transactionObj.transactionMode=this.paymentMode,this.transactionObj.discountAmount=Number(this.discount),this.transactionObj.transactionDate=new Date(this.billdate).getTime(),this.transactionObj.paidAmount=Number(this.totalPayable),this.transactionObj.billDetail=this.billdetail.id,this.transactionObj.receivedFrom=this.receivedFrom,this.dbprovider.save(this.tableName,this.transactionObj).then(e=>{"SUCCESS"==e.status?(this.messageService.add({key:"transactionEntry",severity:"success",summary:this.savedSuccessMessage,detail:""}),this.saveBill()):this.messageService.add({key:"transactionEntry",severity:"error",summary:e.message,detail:"",closable:!0})}).catch(e=>{console.log(e),this.messageService.add({key:"transactionEntry",severity:"error",summary:e,detail:""})}))}saveBill(){this.billdetail.receivedAmount=this.billdetail.receivedAmount+Number(this.amount),this.billdetail.pendingAmount=this.billdetail.pendingAmount-Number(this.amount),this.dbprovider.save(this.billTableName,this.billdetail).then(e=>{console.log(e),"SUCCESS"==e.status&&(this.billdetail.rev=e.rev),this.popoverController.dismiss()}).catch(e=>{this.popoverController.dismiss(),console.log(e)})}presentAlert(){return Object(a.a)(this,void 0,void 0,function*(){const e=yield this.alertController.create({header:"",subHeader:"",message:"Entered amount is greater than pending amount",buttons:["OK"]});yield e.present();const{role:t}=yield e.onDidDismiss();console.log("onDidDismiss resolved with role",t)})}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(s.a),l.Mb(r.a),l.Mb(c.a),l.Mb(c.G),l.Mb(b.h),l.Mb(h.d))},e.\u0275cmp=l.Gb({type:e,selectors:[["transactionEntry"]],inputs:{billdetail:"billdetail"},decls:9,vars:3,consts:[[2,"float","right","padding-bottom","5px","padding-right","10px"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-rounded","p-button-danger",3,"click"],[2,"text-align","center"],["type","datetime-local","id","myLocalDate",2,"background-color","lightgray","align-self","center","width","60%",3,"ngModel","ngModelChange"],[4,"ngIf"],["key","transactionEntry","position","center"],["lines","inset"],["position","floating"],["type","number","required","",3,"value","input"],["type","number",3,"value","input"],["type","number","readonly","",3,"value"],["type","text",3,"value","input"],["name","cash","value","cash","inputId","cash",3,"ngModel","ngModelChange"],[2,"padding-left","2px","padding-right","7px"],["name","upi","value","upi","inputId","upi",3,"ngModel","ngModelChange"],["name","card","value","card","inputId","card",3,"ngModel","ngModelChange"],[2,"padding-left","2px"],["type","submit","color","danger","expand","block",3,"click"]],template:function(e,t){1&e&&(l.Sb(0,"div"),l.Sb(1,"span",0),l.Sb(2,"button",1),l.ac("click",function(){return t.closePopover()}),l.Rb(),l.Rb(),l.Sb(3,"h1",2),l.Ec(4),l.Rb(),l.Sb(5,"div",2),l.Sb(6,"input",3),l.ac("ngModelChange",function(e){return t.billdate=e}),l.Rb(),l.Rb(),l.Cc(7,g,44,32,"form",4),l.Rb(),l.Nb(8,"p-toast",5)),2&e&&(l.Ab(4),l.Fc(t.monthName),l.Ab(2),l.jc("ngModel",t.billdate),l.Ab(1),l.jc("ngIf",t.billdetail))},directives:[d.b,u.a,o.a,o.i,o.l,n.l,o.p,o.j,o.k,p.a],pipes:[h.c],styles:[".my-button[_ngcontent-%COMP%]{--background:#white;--background-activated:#white}"]}),e})();var v=i("tyNb"),f=i("7kUa"),y=i("rEr+"),S=i("Gxio");function A(e,t){1&e&&(l.Sb(0,"colgroup"),l.Nb(1,"col",17),l.Nb(2,"col",18),l.Nb(3,"col",18),l.Nb(4,"col",18),l.Nb(5,"col",18),l.Nb(6,"col",18),l.Nb(7,"col",18),l.Nb(8,"col",18),l.Nb(9,"col",18),l.Nb(10,"col",18),l.Nb(11,"col",18),l.Rb())}function R(e,t){1&e&&l.Nb(0,"p-columnFilter",22)}function C(e,t){if(1&e&&(l.Sb(0,"th"),l.Sb(1,"div",20),l.Ec(2),l.dc(3,"translate"),l.Cc(4,R,1,0,"p-columnFilter",21),l.Rb(),l.Rb()),2&e){const e=t.$implicit;l.Ab(2),l.Gc(" ",l.ec(3,2,e.header)," "),l.Ab(2),l.jc("ngIf","Vehicle Info"==e.header)}}function w(e,t){if(1&e&&(l.Sb(0,"tr"),l.Cc(1,C,5,4,"th",19),l.Rb()),2&e){const e=t.$implicit;l.Ab(1),l.jc("ngForOf",e)}}function M(e,t){if(1&e&&(l.Sb(0,"label"),l.Sb(1,"b"),l.Ec(2),l.Rb(),l.Rb()),2&e){const e=l.cc(3).$implicit;l.Ab(2),l.Fc(e.primaryContact.contactName)}}function k(e,t){if(1&e&&(l.Sb(0,"label"),l.Sb(1,"b"),l.Ec(2),l.Rb(),l.Rb()),2&e){const e=l.cc(3).$implicit;l.Ab(2),l.Fc(e.primaryContact.contactNameInTamil)}}function N(e,t){if(1&e){const e=l.Tb();l.Sb(0,"div",25),l.ac("click",function(){l.wc(e);const t=l.cc(2).$implicit;return l.cc().vehicleCellClick(t)}),l.Sb(1,"label"),l.Ec(2),l.Rb(),l.Nb(3,"br"),l.Sb(4,"label"),l.Ec(5),l.Rb(),l.Nb(6,"br"),l.Cc(7,M,3,1,"label",26),l.Cc(8,k,3,1,"label",26),l.Rb()}if(2&e){const e=l.cc(2).$implicit,t=l.cc();l.Ab(2),l.Hc("",e.vehicleInfo.vehicleBrand," ",e.vehicleInfo.vehicleModel," "),l.Ab(3),l.Fc(e.vehicleInfo.vehicleNumber),l.Ab(2),l.jc("ngIf",t.appLanguage&&"en"==t.appLanguage&&e.primaryContact),l.Ab(1),l.jc("ngIf",t.appLanguage&&"ta"==t.appLanguage&&e.primaryContact)}}function I(e,t){1&e&&l.Nb(0,"p",30)}function E(e,t){1&e&&l.Nb(0,"p",31)}function j(e,t){1&e&&l.Nb(0,"p",32)}function x(e,t){if(1&e){const e=l.Tb();l.Sb(0,"div",25),l.ac("click",function(t){l.wc(e);const i=l.cc().$implicit,n=l.cc().$implicit;return l.cc().amountCellClick(t,n[i.field])}),l.Sb(1,"label"),l.Ec(2),l.dc(3,"translate"),l.Rb(),l.Nb(4,"br"),l.Sb(5,"label"),l.Ec(6),l.dc(7,"translate"),l.Rb(),l.Nb(8,"br"),l.Sb(9,"label"),l.Ec(10),l.dc(11,"translate"),l.Rb(),l.Nb(12,"br"),l.Cc(13,I,1,0,"p",27),l.Cc(14,E,1,0,"p",28),l.Cc(15,j,1,0,"p",29),l.Rb()}if(2&e){const e=l.cc().$implicit,t=l.cc().$implicit;l.Ab(2),l.Hc("T - ",t[e.field].totalAmount," ",l.ec(3,9,"rs"),""),l.Ab(4),l.Hc("R - ",t[e.field].receivedAmount," ",l.ec(7,11,"rs"),""),l.Ab(4),l.Hc("P - ",t[e.field].pendingAmount," ",l.ec(11,13,"rs"),""),l.Ab(3),l.jc("ngIf",0==t[e.field].pendingAmount),l.Ab(1),l.jc("ngIf",t[e.field].receivedAmount>0&&t[e.field].pendingAmount>0),l.Ab(1),l.jc("ngIf",0==t[e.field].receivedAmount)}}function T(e,t){1&e&&(l.Sb(0,"div",33),l.Sb(1,"label"),l.Ec(2,"----"),l.Rb(),l.Rb())}function P(e,t){if(1&e&&(l.Sb(0,"td"),l.Cc(1,N,9,5,"div",23),l.Cc(2,x,16,15,"div",23),l.Cc(3,T,3,0,"div",24),l.Rb()),2&e){const e=t.$implicit,i=l.cc().$implicit;l.Ab(1),l.jc("ngIf","vehicleInfo"==e.field&&i.vehicleInfo),l.Ab(1),l.jc("ngIf","vehicleInfo"!=e.field&&i[e.field]),l.Ab(1),l.jc("ngIf",!i[e.field])}}function O(e,t){if(1&e&&(l.Sb(0,"tr"),l.Cc(1,P,4,3,"td",19),l.Rb()),2&e){const e=t.columns;l.Ab(1),l.jc("ngForOf",e)}}const D=function(){return[5,10,15]},L=[{path:"",component:(()=>{class e{constructor(e,t,i,n,c,o){this.router=e,this.popoverController=t,this.messageService=i,this.location=n,this.translate=c,this.dbprovider=o,this.vehicleList=[],this.allvehicleList=[],this.cols=[],this.frozenCols=[],this.queryText="",this.appLanguage="ta",this.vehicleTableName="vehicle",this.accountTableName="account",this.vehicleContactAssignmentTablename="vehicleContactAssignment",this.billTable="billDetail",this.appLanguage=this.translate.getDefaultLang();let a={1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"};for(var l=new Date,s=l.getMonth()+1,r=Number(l.getFullYear().toString().substr(-2)),b=l.getFullYear(),h=0;h<=10;h++)if(10==h)this.cols.splice(0,0,{field:"vehicleInfo",header:"vehicleSearch.vehicleInfo"});else{0==s&&(s=12,r-=1,b-=1);var d={};d.month=s;let e=s--;d.field=a[e]+r,d.header=a[e]+" "+r,d.year=b,this.cols.push(d)}console.log(this.translate.getDefaultLang()),this.fetchVehicle()}backButtonOnclick(){this.location.back()}billGeneration(){console.log("Generate bill"),this.router.navigate(["billGenerate"])}search(e){console.log(e)}searchByKeyword(){console.log("search",this.queryText),this.vehicleList=[],this.queryText.length>0?this.allvehicleList.forEach(e=>{e.vehicleInfo.vehicleNumber.toLowerCase().includes(this.queryText.toLowerCase())&&this.vehicleList.push(e)}):this.vehicleList=[...this.allvehicleList]}vehicleCellClick(e){console.log("vehicle",e),0==e.billAvailable?this.messageService.add({severity:"info",summary:"Account not available",detail:"Active account not available for this vehicle"}):this.router.navigate(["transactionHistory"],{queryParams:{vehicle:JSON.stringify(e),appLanguage:this.appLanguage}})}amountCellClick(e,t){return Object(a.a)(this,void 0,void 0,function*(){if(console.log("amount",t),t.pendingAmount>0){const e=yield this.popoverController.create({component:m,componentProps:{billdetail:t},translucent:!1,showBackdrop:!0,backdropDismiss:!1});yield e.present();const{role:i}=yield e.onDidDismiss();console.log("onDidDismiss resolved with role",i)}else this.messageService.add({severity:"success",summary:this.translate.instant("vehicleSearch.alreadyPaid")+t.Month,detail:""})})}fetchVehicle(){this.vehicleList=[],this.allvehicleList=[],this.dbprovider.fetchDocsWithRelationshipUsingFindOption({selector:{"data.type":this.vehicleTableName}},!0,{childreference:["account"]}).then(e=>{"SUCCESS"==e.status&&e.records.length>0&&e.records.forEach(e=>{let t={},i={};i.vehicleType=e.vehicleType,i.vehicleBrand=e.vehicleBrand,i.vehicleModel=e.vehicleModel,i.vehicleNumber=e.vehicleNumber,i.vehicleId=e.id,t.vehicleInfo=i,t.accounts=e.accounts;var n=[];n.push(this.fetchContact(t)),n.push(this.fetchBillDetail(t)),Promise.all(n).then(e=>{this.vehicleList.push(t),this.allvehicleList=[...this.vehicleList]})})})}fetchContact(e){this.dbprovider.fetchDocsWithRelationshipUsingFindOption({selector:{"data.type":this.vehicleContactAssignmentTablename,"data.vehicle_lookup":e.vehicleInfo.vehicleId}},!0,{masterandlookupreference:["contact"]}).then(t=>{var i={};"SUCCESS"==t.status&&t.records.length>0?(t.records.forEach(e=>{"owner"==e.contact_lookup.contactType&&(i.contactName=e.contact_lookup.contactName,i.contactNameInTamil=e.contact_lookup.contactNameInTamil)}),e.primaryContact=i):e.primaryContact={}}).catch(t=>{e.primaryContact={}})}fetchBillDetail(e){var t,i=e.accounts;i.length>0?(i.forEach(e=>{null==e.closeDate&&(t=e)}),t?(e.activeAccountId=t.id,this.dbprovider.fetchDocsWithoutRelationshipByParentTypeAndId(this.billTable,this.accountTableName,t.id).then(t=>{console.log("bill",t),"SUCCESS"==t.status&&t.records.length>0&&this.cols.forEach(i=>{i.month&&t.records.forEach(t=>{t.billMonth==i.month&&t.billYear==i.year&&(e[i.field]=t)})}),console.log("fullVehicleInfo",e)}).catch(e=>{console.log(e)})):e.billAvailable=!1):(console.log("account length 0"),e.billAvailable=!1)}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(v.g),l.Mb(c.G),l.Mb(b.h),l.Mb(n.h),l.Mb(h.d),l.Mb(r.a))},e.\u0275cmp=l.Gb({type:e,selectors:[["vehicleSearch"]],decls:24,vars:16,consts:[["no-border",""],["slot","start"],["slot","start",3,"click"],["name","arrow-back",2,"font-size","30px","color","black"],["size","large",1,"ion-text-center"],[2,"position","fixed"],["ion-fixed","",1,"center"],["pInputText","","type","text",2,"width","100%",3,"ngModel","placeholder","ngModelChange","keyup.enter"],[2,"padding-left","5px","width","50px"],["pButton","","pRipple","","type","button","icon","pi pi-search",1,"p-button-rounded","p-button-success",3,"click"],["slot","end",3,"click"],[2,"top","60px"],["paginatorPosition","top","sortMode","multiple","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","styleClass","p-datatable-lg",3,"columns","value","alwaysShowPaginator","scrollable","paginator","rows","showCurrentPageReport","rowsPerPageOptions"],["pTemplate","colgroup"],["pTemplate","header"],["pTemplate","body"],["position","center"],[2,"width","200px"],[2,"width","150px"],[4,"ngFor","ngForOf"],[1,"p-d-flex","p-jc-between","p-ai-center"],["type","text","field","vehicleInfo.vehicleNumber","display","menu",4,"ngIf"],["type","text","field","vehicleInfo.vehicleNumber","display","menu"],[3,"click",4,"ngIf"],["style","text-align: center;",4,"ngIf"],[3,"click"],[4,"ngIf"],["style","width: 100%; height: 15px; background-color: green;",4,"ngIf"],["style","width: 100%; height: 15px; background-color: yellow;",4,"ngIf"],["style","width: 100%; height: 15px; background-color: red;",4,"ngIf"],[2,"width","100%","height","15px","background-color","green"],[2,"width","100%","height","15px","background-color","yellow"],[2,"width","100%","height","15px","background-color","red"],[2,"text-align","center"]],template:function(e,t){1&e&&(l.Sb(0,"ion-header",0),l.Sb(1,"ion-toolbar"),l.Sb(2,"ion-buttons",1),l.Sb(3,"ion-button",2),l.ac("click",function(){return t.backButtonOnclick()}),l.Sb(4,"h2"),l.Nb(5,"ion-icon",3),l.Rb(),l.Rb(),l.Rb(),l.Sb(6,"ion-title",4),l.Ec(7),l.dc(8,"translate"),l.Rb(),l.Rb(),l.Rb(),l.Sb(9,"ion-content"),l.Sb(10,"ion-toolbar",5),l.Sb(11,"ion-item",6),l.Sb(12,"input",7),l.ac("ngModelChange",function(e){return t.queryText=e})("keyup.enter",function(){return t.searchByKeyword()}),l.dc(13,"translate"),l.Rb(),l.Sb(14,"span",8),l.Sb(15,"button",9),l.ac("click",function(){return t.searchByKeyword()}),l.Rb(),l.Rb(),l.Rb(),l.Sb(16,"ion-button",10),l.ac("click",function(){return t.billGeneration()}),l.Ec(17,"Bill Generate "),l.Rb(),l.Rb(),l.Sb(18,"div",11),l.Sb(19,"p-table",12),l.Cc(20,A,12,0,"ng-template",13),l.Cc(21,w,2,1,"ng-template",14),l.Cc(22,O,2,1,"ng-template",15),l.Rb(),l.Rb(),l.Nb(23,"p-toast",16),l.Rb()),2&e&&(l.Ab(7),l.Gc(" ",l.ec(8,11,"vehicleSearch.title")," "),l.Ab(5),l.kc("placeholder",l.ec(13,13,"vehicleSearch.searchPlaceholder")),l.jc("ngModel",t.queryText),l.Ab(7),l.jc("columns",t.cols)("value",t.vehicleList)("alwaysShowPaginator",!0)("scrollable",!0)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",l.lc(15,D)))},directives:[c.n,c.A,c.e,c.d,c.o,c.z,c.k,c.q,o.a,f.a,o.i,o.l,d.b,u.a,y.c,b.j,S.a,n.k,n.l,y.a],pipes:[h.c],styles:[".center[_ngcontent-%COMP%]{display:flex;justify-content:center;align-content:center;align-items:center;width:50%;margin:auto;min-width:300px}.popover-content[_ngcontent-%COMP%]{opacity:inherit}.my-button[_ngcontent-%COMP%]{--background:#white;--background-activated:#white}"]}),e})()}];let F=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},imports:[[y.d,v.k.forChild(L),n.c,o.f,c.B,S.b,f.b,d.c,u.b,h.b],v.k]}),e})()}}]);