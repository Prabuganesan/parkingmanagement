!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{koon:function(n,i,o){"use strict";o.r(i),o.d(i,"startupModule",function(){return _});var r=o("ofXK"),c=o("TEn/"),s=o("3Pt+"),a=o("fXoL"),l=o("tyNb"),d=o("fU03"),p=o("7zfz"),u=o("tp0D"),g=o("/RsI"),h=o("7kUa"),f=o("Gxio"),m=o("jIHw");function b(e,t){if(1&e){var n=a.Tb();a.Sb(0,"div",11),a.Sb(1,"div",12),a.ac("click",function(){a.wc(n);var e=t.$implicit;return a.cc().openMenu(e)}),a.Sb(2,"div",13),a.Nb(3,"ion-icon",14),a.Rb(),a.Sb(4,"span",15),a.Ec(5),a.Rb(),a.Rb(),a.Rb()}if(2&e){var i=t.$implicit;a.Ab(5),a.Fc(i.userName)}}function v(e,t){if(1&e){var n=a.Tb();a.Sb(0,"p-button",16),a.ac("click",function(){return a.wc(n),a.cc().login()}),a.Rb()}}var y,C,M=function(){return{width:"300px"}},P=[{path:"",component:(y=function(){function n(t,i,o,r){var c=this;e(this,n),this.router=t,this.util=i,this.messageService=o,this.dbprovider=r,this.display=!1,this.password="",this.userTableName="applicationUser",this.loginActivityTableName="loginActivities",this.users=[],r.oneTimeReplicationFromServer().then(function(e){console.log(e),e.ok||(console.log("Replication failed, Please up the server"),c.messageService.add({key:"startup",severity:"error",summary:"Replication failed, Please up the server",detail:"",closable:!0})),c.dbprovider.startSync(),c.createViewDoc(),c.createFirstAdmin()}).catch(function(e){console.log("Replication failed, Please up the server"),c.messageService.add({key:"startup",severity:"error",summary:"Replication failed, Please up the server",detail:"",closable:!0}),c.dbprovider.startSync(),c.createViewDoc(),c.createFirstAdmin()})}var i,o,r;return i=n,(o=[{key:"openMenu",value:function(e){console.log(e),this.display=!0,this.selectedUser=e}},{key:"login",value:function(){var e=this;this.selectedUser.password==this.password?(this.util.userId=this.selectedUser.code,this.util.loggedUserInfo=this.selectedUser,this.addLoginActivity().then(function(t){t?(e.insertLocalDoc(),setTimeout(function(){return e.router.navigate(["/menu"])},300)):e.messageService.add({key:"startup",severity:"error",summary:"Login activity tracking failed",detail:"",closable:!0}),e.display=!1}),this.password=""):(this.messageService.add({key:"startup",severity:"error",summary:"Invalid password",detail:"",closable:!0}),this.display=!1,this.password="")}},{key:"ionViewWillEnter",value:function(){var e=this;console.log("view"),this.fetchUserData().then(function(t){t.records&&t.records.length>0&&(e.users=t.records)})}},{key:"insertLocalDoc",value:function(){this.dbprovider.insertLocalDoc({_id:"_local/loginInfo",userId:this.util.userId,loggedUserInfo:this.util.loggedUserInfo,loggedUserActivity:this.util.loggedUserActivityInfo})}},{key:"fetchLocalDoc",value:function(){this.dbprovider.getLocalDoc("_local/loginInfo").then(function(e){console.log(e)})}},{key:"addLoginActivity",value:function(){var e=this,t=(new Date).getTime(),n=!1;return this.dbprovider.save(this.loginActivityTableName,{inTime:t,outTime:null,applicationUser:this.selectedUser.id}).then(function(t){if("SUCCESS"==t.status)return n=!0,e.dbprovider.fetchDocWithoutRelationshipByTypeAndId(e.loginActivityTableName,t.id).then(function(t){return console.log("resss=",t),"SUCCESS"==t.status&&t.records&&t.records.length>0&&(e.util.loggedUserActivityInfo=t.records[0]),n})}).catch(function(e){return n})}},{key:"createFirstAdmin",value:function(){var e=this;this.fetchUserData().then(function(t){var n=!1;t.records&&t.records.length>0&&t.records.forEach(function(e){"Admin"==e.userType&&(n=!0)}),console.log(n),0==n?(e.util.userId=1,e.dbprovider.save(e.userTableName,{userName:"Shunmu",mobile:9841163959,code:1,userType:"Admin",password:"shunmu"}).then(function(t){console.log("result",t),"SUCCESS"==t.status?e.fetchUserData().then(function(t){t.records&&t.records.length>0&&(e.users=t.records)}):e.messageService.add({key:"startup",severity:"error",summary:"First time user creation failed",detail:"",closable:!0})}).catch(function(t){e.messageService.add({key:"startup",severity:"error",summary:"First time user creation failed",detail:""})})):e.fetchUserData().then(function(t){t.records&&t.records.length>0&&(e.users=t.records,e.dbprovider.getLocalDoc("_local/loginInfo").then(function(t){"SUCCESS"==t.status&&(console.log(t),e.util.userId=t.response.userId,e.util.loggedUserInfo=t.response.loggedUserInfo,e.util.loggedUserActivityInfo=t.response.loggedUserActivity,setTimeout(function(){return e.router.navigate(["/menu"])},300))}))})})}},{key:"fetchUserData",value:function(){var e=this;return this.dbprovider.fetchDocsWithoutRelationshipByType(this.userTableName).then(function(e){return e&&"SUCCESS"==e.status?e:[]}).catch(function(t){return e.messageService.add({key:"startup",severity:"error",summary:"User fetching failed",detail:""}),[]})}},{key:"createViewDoc",value:function(){this.dbprovider.saveDdoc({_id:"_design/billIndex",views:{billIndex:{map:"function (doc) {var month;if (doc.data.billMonth < 10) { month = '0' + doc.data.billMonth;} else {month = doc.data.billMonth;} emit(doc.data.account+'-'+doc.data.billYear+'-'+month) }"}}}).then(function(e){console.log("index",e)}).catch(function(e){console.log("index error",e)})}}])&&t(i.prototype,o),r&&t(i,r),n}(),y.\u0275fac=function(e){return new(e||y)(a.Mb(l.g),a.Mb(d.a),a.Mb(p.h),a.Mb(u.a))},y.\u0275cmp=a.Gb({type:y,selectors:[["startup"]],decls:13,vars:10,consts:[[1,"auth-form","background",3,"fullscreen"],["size","large",1,"ion-text-center",2,"height","50px","font-size","22px"],[1,"pm-landing-page"],[1,"pm-startup-bg"],["src","../../../assets/parking.jpg","alt","parking"],[1,"pm-startup-ulist"],["class","pm-l-p",4,"ngFor","ngForOf"],["header","Enter password",3,"visible","modal","responsive","appendTo","visibleChange"],["pInputText","","type","text","placeholder"," Password",3,"ngModel","ngModelChange"],["pTemplate","footer"],["key","startup","position","bottom-center"],[1,"pm-l-p"],[1,"pm-l-p-s",3,"click"],[1,"pm-u-icon-p"],["name","person",1,"pm-u-icon"],[1,"pm-truncate","pm-width-option"],["icon","pi pi-check","label","Login",1,"p-button-text",3,"click"]],template:function(e,t){1&e&&(a.Sb(0,"ion-content",0),a.Sb(1,"div"),a.Sb(2,"ion-title",1),a.Ec(3," Parking management "),a.Rb(),a.Rb(),a.Sb(4,"div",2),a.Sb(5,"div",3),a.Nb(6,"img",4),a.Rb(),a.Sb(7,"div",5),a.Cc(8,b,6,1,"div",6),a.Rb(),a.Rb(),a.Sb(9,"p-dialog",7),a.ac("visibleChange",function(e){return t.display=e}),a.Sb(10,"ion-input",8),a.ac("ngModelChange",function(e){return t.password=e}),a.Rb(),a.Cc(11,v,1,0,"ng-template",9),a.Rb(),a.Nb(12,"p-toast",10),a.Rb()),2&e&&(a.jc("fullscreen",!0),a.Ab(8),a.jc("ngForOf",t.users),a.Ab(1),a.Ac(a.lc(9,M)),a.jc("visible",t.display)("modal",!0)("responsive",!0)("appendTo","body"),a.Ab(1),a.jc("ngModel",t.password))},directives:[c.k,c.z,r.k,g.a,c.p,c.K,h.a,s.i,s.l,p.j,f.a,c.o,m.a],styles:['.divider[_ngcontent-%COMP%]{display:flex}.divider[_ngcontent-%COMP%]:after, .divider[_ngcontent-%COMP%]:before{content:"";flex:1}.line[_ngcontent-%COMP%]{align-items:center;margin:1em -1em;color:#ccc}.line[_ngcontent-%COMP%]:after, .line[_ngcontent-%COMP%]:before{height:1px;margin:0 1em}.one-line[_ngcontent-%COMP%]:after, .one-line[_ngcontent-%COMP%]:before{background:#ccc}.auth-form[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%], .auth-form[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{height:50%;justify-content:center}.already[_ngcontent-%COMP%]{display:block;text-align:center;padding-bottom:10px}.circle[_ngcontent-%COMP%]{width:50%;height:50%;background:#0ff;border:5px solid #00f}.circleBase[_ngcontent-%COMP%]{border-radius:50%}ion-content[_ngcontent-%COMP%]{--background:#fff}ion-title[_ngcontent-%COMP%]{color:#000}.pm-landing-page[_ngcontent-%COMP%]{display:inline-flex;width:100%;height:calc(100% - 50px);align-items:center;overflow:hidden}.pm-landing-page[_ngcontent-%COMP%]   .pm-startup-bg[_ngcontent-%COMP%]{width:60%}.pm-landing-page[_ngcontent-%COMP%]   .pm-startup-ulist[_ngcontent-%COMP%]{width:40%;display:inline-flex;flex-direction:column;height:100%;justify-content:center;overflow-x:hidden;overflow-y:auto}.pm-landing-page[_ngcontent-%COMP%]   .pm-startup-ulist[_ngcontent-%COMP%]   .pm-l-p[_ngcontent-%COMP%]{background:#acacac;display:inline-flex;width:calc(100% - 90px);padding:10px;border-radius:5px;margin:10px;box-shadow:0 2px 8px 0 rgba(99,99,99,.2)}.pm-landing-page[_ngcontent-%COMP%]   .pm-startup-ulist[_ngcontent-%COMP%]   .pm-l-p[_ngcontent-%COMP%]   .pm-l-p-s[_ngcontent-%COMP%]{display:inline-flex;align-items:center;width:100%}.pm-landing-page[_ngcontent-%COMP%]   .pm-startup-ulist[_ngcontent-%COMP%]   .pm-l-p[_ngcontent-%COMP%]   .pm-l-p-s[_ngcontent-%COMP%]   .pm-u-icon-p[_ngcontent-%COMP%]{background:#909090;border-radius:500px;height:50px;width:50px;display:inline-flex;align-items:center;justify-content:center;margin-right:10px}.pm-landing-page[_ngcontent-%COMP%]   .pm-startup-ulist[_ngcontent-%COMP%]   .pm-l-p[_ngcontent-%COMP%]   .pm-l-p-s[_ngcontent-%COMP%]   .pm-u-icon-p[_ngcontent-%COMP%]   .pm-u-icon[_ngcontent-%COMP%], .pm-landing-page[_ngcontent-%COMP%]   .pm-startup-ulist[_ngcontent-%COMP%]   .pm-l-p[_ngcontent-%COMP%]   .pm-l-p-s[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:26px}.pm-landing-page[_ngcontent-%COMP%]   .pm-startup-ulist[_ngcontent-%COMP%]   .pm-width-option[_ngcontent-%COMP%]{width:calc(100% - 60px)}']}),y)}],_=((C=function t(){e(this,t)}).\u0275mod=a.Kb({type:C}),C.\u0275inj=a.Jb({factory:function(e){return new(e||C)},imports:[[l.k.forChild(P),r.c,s.f,c.B,g.b,m.c,h.b,f.b],l.k]}),C)}}])}();